{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="{% static 'main/lib/jquery-ui-1.12.1.min.css' %}">
    <link rel="stylesheet" href="{% static 'main/css/style.css' %}">
    <title>Airbnb CLONE</title>
</head>
<body>
    <div class="nav-bar">
        <div class="nav-logo-link">
            <a href="{% url 'main:index' %}"><svg viewBox="0 0 1000 1000" role="presentation" aria-hidden="true" focusable="false" style="height: 1em; width: 1em; display: block; fill: currentcolor; color: #FF5A5F; font-size: 34px;"><path d="m499.3 736.7c-51-64-81-120.1-91-168.1-10-39-6-70 11-93 18-27 45-40 80-40s62 13 80 40c17 23 21 54 11 93-11 49-41 105-91 168.1zm362.2 43c-7 47-39 86-83 105-85 37-169.1-22-241.1-102 119.1-149.1 141.1-265.1 90-340.2-30-43-73-64-128.1-64-111 0-172.1 94-148.1 203.1 14 59 51 126.1 110 201.1-37 41-72 70-103 88-24 13-47 21-69 23-101 15-180.1-83-144.1-184.1 5-13 15-37 32-74l1-2c55-120.1 122.1-256.1 199.1-407.2l2-5 22-42c17-31 24-45 51-62 13-8 29-12 47-12 36 0 64 21 76 38 6 9 13 21 22 36l21 41 3 6c77 151.1 144.1 287.1 199.1 407.2l1 1 20 46 12 29c9.2 23.1 11.2 46.1 8.2 70.1zm46-90.1c-7-22-19-48-34-79v-1c-71-151.1-137.1-287.1-200.1-409.2l-4-6c-45-92-77-147.1-170.1-147.1-92 0-131.1 64-171.1 147.1l-3 6c-63 122.1-129.1 258.1-200.1 409.2v2l-21 46c-8 19-12 29-13 32-51 140.1 54 263.1 181.1 263.1 1 0 5 0 10-1h14c66-8 134.1-50 203.1-125.1 69 75 137.1 117.1 203.1 125.1h14c5 1 9 1 10 1 127.1.1 232.1-123 181.1-263.1z"></path></svg></a>
        </div>
        <div class="nav-logo-dd">
            <a id="home" style="cursor: pointer;" url="{% url 'main:index' %}">
                <svg viewBox="0 0 1000 1000" role="presentation" aria-hidden="true" focusable="false" style="height: 1em; width: 1em; display: block; fill: currentcolor; color: #FF5A5F; font-size: 34px;"><path d="m499.3 736.7c-51-64-81-120.1-91-168.1-10-39-6-70 11-93 18-27 45-40 80-40s62 13 80 40c17 23 21 54 11 93-11 49-41 105-91 168.1zm362.2 43c-7 47-39 86-83 105-85 37-169.1-22-241.1-102 119.1-149.1 141.1-265.1 90-340.2-30-43-73-64-128.1-64-111 0-172.1 94-148.1 203.1 14 59 51 126.1 110 201.1-37 41-72 70-103 88-24 13-47 21-69 23-101 15-180.1-83-144.1-184.1 5-13 15-37 32-74l1-2c55-120.1 122.1-256.1 199.1-407.2l2-5 22-42c17-31 24-45 51-62 13-8 29-12 47-12 36 0 64 21 76 38 6 9 13 21 22 36l21 41 3 6c77 151.1 144.1 287.1 199.1 407.2l1 1 20 46 12 29c9.2 23.1 11.2 46.1 8.2 70.1zm46-90.1c-7-22-19-48-34-79v-1c-71-151.1-137.1-287.1-200.1-409.2l-4-6c-45-92-77-147.1-170.1-147.1-92 0-131.1 64-171.1 147.1l-3 6c-63 122.1-129.1 258.1-200.1 409.2v2l-21 46c-8 19-12 29-13 32-51 140.1 54 263.1 181.1 263.1 1 0 5 0 10-1h14c66-8 134.1-50 203.1-125.1 69 75 137.1 117.1 203.1 125.1h14c5 1 9 1 10 1 127.1.1 232.1-123 181.1-263.1z"></path></svg>
            </a>
        </div>
        <div class="nav-search-lg">
            <div>
                <form action="">
                    <div><svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="height: 24px; width: 24px; display: block; fill: rgb(118, 118, 118);"><path d="m10.4 18.2c-4.2-.6-7.2-4.5-6.6-8.8.6-4.2 4.5-7.2 8.8-6.6 4.2.6 7.2 4.5 6.6 8.8-.6 4.2-4.6 7.2-8.8 6.6m12.6 3.8-5-5c1.4-1.4 2.3-3.1 2.6-5.2.7-5.1-2.8-9.7-7.8-10.5-5-.7-9.7 2.8-10.5 7.9-.7 5.1 2.8 9.7 7.8 10.5 2.5.4 4.9-.3 6.7-1.7v.1l5 5c .3.3.8.3 1.1 0s .4-.8.1-1.1" fill-rule="evenodd"></path></svg></div>
                    <input type="text" placeholder="Search...">
                </form>
            </div>
        </div>
        <div class="nav-search-sm">
            <div>
                <button>
                    <div><svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="padding-right: 10px; height: 16px; width: 16px; display: block; fill: currentcolor;"><path d="m10.4 18.2c-4.2-.6-7.2-4.5-6.6-8.8.6-4.2 4.5-7.2 8.8-6.6 4.2.6 7.2 4.5 6.6 8.8-.6 4.2-4.6 7.2-8.8 6.6m12.6 3.8-5-5c1.4-1.4 2.3-3.1 2.6-5.2.7-5.1-2.8-9.7-7.8-10.5-5-.7-9.7 2.8-10.5 7.9-.7 5.1 2.8 9.7 7.8 10.5 2.5.4 4.9-.3 6.7-1.7v.1l5 5c .3.3.8.3 1.1 0s .4-.8.1-1.1" fill-rule="evenodd"></path></svg></div>
                    <div>Search...</div>
                </button>
            </div>
        </div>
        <div class="nav-menu">
            <div>
                {% if request.session.user_id %}
                    <button>Become a host</button>
                    <button>Saved</button>
                    <button>Trips</button>
                    <button>Messages</button>
                    <button>Credit</button>
                    <button>Help</button>
                    <button url="{% url 'main:logout' %}" id="btn-logout">Logout</button>
                {% else %}
                    <button>Become a host</button>
                    <button>Earn credit</button>
                    <button>Help</button>
                    <button id="btn-signup">Sign Up</button>
                    <button id="btn-login">Log In</button>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="dlg-signup" style="display: none; padding: 32px 32px">
        <div style="margin-bottom: 24px;">
            <button id="close" style="border: 0;">
                <svg viewBox="0 0 24 24" role="img" aria-label="Close" focusable="false" style="height: 16px; width: 16px; display: block; fill: rgb(118, 118, 118);"><path d="m23.25 24c-.19 0-.38-.07-.53-.22l-10.72-10.72-10.72 10.72c-.29.29-.77.29-1.06 0s-.29-.77 0-1.06l10.72-10.72-10.72-10.72c-.29-.29-.29-.77 0-1.06s.77-.29 1.06 0l10.72 10.72 10.72-10.72c.29-.29.77-.29 1.06 0s .29.77 0 1.06l-10.72 10.72 10.72 10.72c.29.29.29.77 0 1.06-.15.15-.34.22-.53.22" fill-rule="evenodd"></path></svg>
            </button>
        </div>
        <button  class="white-on-blue" style="font-size: 19px; border-radius: 4px; height: 50px; width: 100%;">
            <div style="display: table; margin: 0px auto;">
                <div style="display: table-cell;">
                    <svg viewBox="0 0 32 32" role="presentation" aria-hidden="true" focusable="false" style="height: 18px; width: 18px; display: block; fill: currentcolor;"><path d="m8 14.41v-4.17c0-.42.35-.81.77-.81h2.52v-2.08c0-4.84 2.48-7.31 7.42-7.35 1.65 0 3.22.21 4.69.64.46.14.63.42.6.88l-.56 4.06c-.04.18-.14.35-.32.53-.21.11-.42.18-.63.14-.88-.25-1.78-.35-2.8-.35-1.4 0-1.61.28-1.61 1.73v1.8h4.52c.42 0 .81.42.81.88l-.35 4.17c0 .42-.35.71-.77.71h-4.21v16c0 .42-.35.81-.77.81h-5.21c-.42 0-.8-.39-.8-.81v-16h-2.52a.78.78 0 0 1 -.78-.78" fill-rule="evenodd"></path></svg>
                </div>
                <div style="display: table-cell; padding-left: 12px;">Continue with Facebook</div>
            </div>
        </button>
        <button style="margin-top: 10px; font-size: 19px; color: black; border: 2px solid black; border-radius: 4px; height: 50px; width: 100%;">
            <div style="display: table; margin: 0px auto;">
                <div style="display: table-cell;">
                    <svg viewBox="0 0 18 18" role="presentation" aria-hidden="true" focusable="false" style="height: 18px; width: 18px; display: block;"><g fill="none" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path d="M0 0h18v18H0V0z"></path></g></svg>
                </div>
                <div style="display: table-cell; padding-left: 12px;">Continue with Google</div>
            </div>
        </button>
        <div style="margin-top: 16px; margin-bottom: 16px; text-align: center;">or</div>
        <form action="{% url 'main:signup_ajax' %}" method="POST">
            <div class="common-border" style="font-size: 19px; height: 44px;">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="margin-right: 11px; margin-top: 11px; float: right; height: 1em; width: 1em; display: block; fill: currentcolor;"><path d="m22.5 4h-21c-.83 0-1.5.67-1.5 1.51v12.99c0 .83.67 1.5 1.5 1.5h20.99a1.5 1.5 0 0 0 1.51-1.51v-12.98c0-.84-.67-1.51-1.5-1.51zm.5 14.2-6.14-7.91 6.14-4.66v12.58zm-.83-13.2-9.69 7.36c-.26.2-.72.2-.98 0l-9.67-7.36h20.35zm-21.17.63 6.14 4.67-6.14 7.88zm.63 13.37 6.3-8.1 2.97 2.26c.62.47 1.57.47 2.19 0l2.97-2.26 6.29 8.1z" fill-rule="evenodd"></path></svg>
                <div style="padding-right: 35px; padding-left: 10px; padding-top: 10px;">
                    <input id="email" type="email" placeholder="Email address" style="width: 100%; border: 0">
                </div>
            </div>
            <div class="common-border" style="margin-top: 10px; font-size: 19px; height: 44px;">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="margin-right: 11px; margin-top: 11px; float: right; height: 1em; width: 1em; display: block; fill: currentcolor;"><path d="m14.76 11.38a6.01 6.01 0 0 0 3.28-5.36 6.02 6.02 0 0 0 -12.04 0 6.01 6.01 0 0 0 3.27 5.35c-4.81 1.22-9.27 5.31-9.27 8.7 0 1.56 6.8 3.93 12 3.93 5.23 0 12-2.34 12-3.93 0-3.39-4.45-7.47-9.24-8.7zm-7.76-5.36a5.02 5.02 0 0 1 10.04 0c0 2.69-2.12 4.87-4.78 5-.09 0-.18-.01-.26-.01s-.16.01-.24.01c-2.65-.14-4.76-2.32-4.76-5zm15.9 14.09a3.8 3.8 0 0 1 -.64.44c-.62.36-1.5.75-2.52 1.1-2.41.83-5.18 1.35-7.74 1.35-2.55 0-5.32-.52-7.74-1.37-1.01-.35-1.9-.74-2.52-1.1-.47-.27-.74-.51-.74-.46 0-3.35 5.55-7.85 10.64-8.05.13.01.25.02.38.02.12 0 .24-.01.36-.02 5.09.22 10.62 4.71 10.62 8.05 0-.07-.02-.04-.1.04z" fill-rule="evenodd"></path></svg>
                <div style="padding-right: 35px; padding-left: 10px; padding-top: 10px;">
                    <input id="fullname" type="text" placeholder="Full name" style="width: 100%; border: 0">
                </div>
            </div>
            <div class="common-border" style="margin-top: 10px; font-size: 19px; height: 44px;">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="margin-right: 11px; margin-top: 11px; float: right; height: 1em; width: 1em; display: block; fill: currentcolor;"><path d="m19.5 9h-.5v-2a7 7 0 1 0 -14 0v2h-.5c-.78 0-1.5.72-1.5 1.5v12c0 .78.72 1.5 1.5 1.5h15c .78 0 1.5-.72 1.5-1.5v-12c0-.78-.72-1.5-1.5-1.5zm.5 13.5c0 .22-.28.5-.5.5h-15c-.22 0-.5-.28-.5-.5v-12c0-.22.28-.5.5-.5h1a .5.5 0 0 0 .5-.5v-2.5a6 6 0 1 1 12 0v2.5a.5.5 0 0 0 .5.5h1c .22 0 .5.28.5.5zm-8-10.5a3 3 0 0 0 -3 3c0 .83.36 1.59.94 2.15l-.9 2.16a.5.5 0 0 0 .46.69h5a .5.5 0 0 0 .46-.69l-.87-2.19c.56-.55.91-1.31.91-2.13a3 3 0 0 0 -3-3zm1.04 5.19.72 1.81h-3.51l.74-1.79a.5.5 0 0 0 -.17-.6 2 2 0 1 1 3.18-1.61c0 .64-.31 1.24-.8 1.6a.5.5 0 0 0 -.17.59zm-1.04-14.19a4 4 0 0 0 -4 4v2.5a.5.5 0 0 0 .5.5h7a .5.5 0 0 0 .5-.5v-2.5a4 4 0 0 0 -4-4zm3 6h-6v-2a3 3 0 1 1 6 0z" fill-rule="evenodd"></path></svg>
                <div style="padding-right: 35px; padding-left: 10px; padding-top: 10px;">
                    <input id="password" type="password" placeholder="Create a Password" style="width: 100%; border: 0">
                </div>
            </div>
            <button id="signup" class="white-on-red" style="margin-top: 10px; font-size: 19px; border-radius: 4px; height: 50px; width: 100%;">Sign up</button>
        </form>
        <div class="common-border" style="margin-top: 16px; margin-bottom: 16px;"></div>
        <div style="text-align: center;">
            <span style="margin-right: 10px;">Already have an Airbnb account?</span><span><a id="login" class="green-on-white" style="cursor: pointer;">Log in</a></span>
        </div>
        <div id="error" class="orange-on-white" style="margin-top: 10px; padding-left: 10px;"></div>
    </div>

    <div id="dlg-login" style="display: none; padding: 32px 32px">
        <div style="margin-bottom: 24px;">
            <button id="close" style="border: 0;">
                <svg viewBox="0 0 24 24" role="img" aria-label="Close" focusable="false" style="height: 16px; width: 16px; display: block; fill: rgb(118, 118, 118);"><path d="m23.25 24c-.19 0-.38-.07-.53-.22l-10.72-10.72-10.72 10.72c-.29.29-.77.29-1.06 0s-.29-.77 0-1.06l10.72-10.72-10.72-10.72c-.29-.29-.29-.77 0-1.06s.77-.29 1.06 0l10.72 10.72 10.72-10.72c.29-.29.77-.29 1.06 0s .29.77 0 1.06l-10.72 10.72 10.72 10.72c.29.29.29.77 0 1.06-.15.15-.34.22-.53.22" fill-rule="evenodd"></path></svg>
            </button>
        </div>
        <button class="white-on-blue" style="font-size: 19px; border-radius: 4px; height: 50px; width: 100%;">
            <div style="display: table; margin: 0px auto;">
                <div style="display: table-cell;">
                    <svg viewBox="0 0 32 32" role="presentation" aria-hidden="true" focusable="false" style="height: 18px; width: 18px; display: block; fill: currentcolor;"><path d="m8 14.41v-4.17c0-.42.35-.81.77-.81h2.52v-2.08c0-4.84 2.48-7.31 7.42-7.35 1.65 0 3.22.21 4.69.64.46.14.63.42.6.88l-.56 4.06c-.04.18-.14.35-.32.53-.21.11-.42.18-.63.14-.88-.25-1.78-.35-2.8-.35-1.4 0-1.61.28-1.61 1.73v1.8h4.52c.42 0 .81.42.81.88l-.35 4.17c0 .42-.35.71-.77.71h-4.21v16c0 .42-.35.81-.77.81h-5.21c-.42 0-.8-.39-.8-.81v-16h-2.52a.78.78 0 0 1 -.78-.78" fill-rule="evenodd"></path></svg>
                </div>
                <div style="display: table-cell; padding-left: 12px;">Continue with Facebook</div>
            </div>
        </button>
        <button style="margin-top: 10px; font-size: 19px; color: black; border: 2px solid black; border-radius: 4px; height: 50px; width: 100%;">
            <div style="display: table; margin: 0px auto;">
                <div style="display: table-cell;">
                    <svg viewBox="0 0 18 18" role="presentation" aria-hidden="true" focusable="false" style="height: 18px; width: 18px; display: block;"><g fill="none" fill-rule="evenodd"><path d="M9 3.48c1.69 0 2.83.73 3.48 1.34l2.54-2.48C13.46.89 11.43 0 9 0 5.48 0 2.44 2.02.96 4.96l2.91 2.26C4.6 5.05 6.62 3.48 9 3.48z" fill="#EA4335"></path><path d="M17.64 9.2c0-.74-.06-1.28-.19-1.84H9v3.34h4.96c-.1.83-.64 2.08-1.84 2.92l2.84 2.2c1.7-1.57 2.68-3.88 2.68-6.62z" fill="#4285F4"></path><path d="M3.88 10.78A5.54 5.54 0 0 1 3.58 9c0-.62.11-1.22.29-1.78L.96 4.96A9.008 9.008 0 0 0 0 9c0 1.45.35 2.82.96 4.04l2.92-2.26z" fill="#FBBC05"></path><path d="M9 18c2.43 0 4.47-.8 5.96-2.18l-2.84-2.2c-.76.53-1.78.9-3.12.9-2.38 0-4.4-1.57-5.12-3.74L.97 13.04C2.45 15.98 5.48 18 9 18z" fill="#34A853"></path><path d="M0 0h18v18H0V0z"></path></g></svg>
                </div>
                <div style="display: table-cell; padding-left: 12px;">Continue with Google</div>
            </div>
        </button>
        <div style="margin-top: 16px; margin-bottom: 16px; text-align: center;">or</div>
        <form action="{% url 'main:login_ajax' %}" method="POST">
            <div class="common-border" style="font-size: 19px; height: 44px;">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="margin-right: 11px; margin-top: 11px; float: right; height: 1em; width: 1em; display: block; fill: currentcolor;"><path d="m22.5 4h-21c-.83 0-1.5.67-1.5 1.51v12.99c0 .83.67 1.5 1.5 1.5h20.99a1.5 1.5 0 0 0 1.51-1.51v-12.98c0-.84-.67-1.51-1.5-1.51zm.5 14.2-6.14-7.91 6.14-4.66v12.58zm-.83-13.2-9.69 7.36c-.26.2-.72.2-.98 0l-9.67-7.36h20.35zm-21.17.63 6.14 4.67-6.14 7.88zm.63 13.37 6.3-8.1 2.97 2.26c.62.47 1.57.47 2.19 0l2.97-2.26 6.29 8.1z" fill-rule="evenodd"></path></svg>
                <div style="padding-right: 35px; padding-left: 10px; padding-top: 10px;">
                    <input id="email" type="text" placeholder="Email address" style="width: 100%; border: 0">
                </div>
            </div>
            <div class="common-border" style="margin-top: 15px; font-size: 19px; height: 44px;">
                <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true" focusable="false" style="margin-right: 11px; margin-top: 11px; float: right; height: 1em; width: 1em; display: block; fill: currentcolor;"><path d="m19.5 9h-.5v-2a7 7 0 1 0 -14 0v2h-.5c-.78 0-1.5.72-1.5 1.5v12c0 .78.72 1.5 1.5 1.5h15c .78 0 1.5-.72 1.5-1.5v-12c0-.78-.72-1.5-1.5-1.5zm.5 13.5c0 .22-.28.5-.5.5h-15c-.22 0-.5-.28-.5-.5v-12c0-.22.28-.5.5-.5h1a .5.5 0 0 0 .5-.5v-2.5a6 6 0 1 1 12 0v2.5a.5.5 0 0 0 .5.5h1c .22 0 .5.28.5.5zm-8-10.5a3 3 0 0 0 -3 3c0 .83.36 1.59.94 2.15l-.9 2.16a.5.5 0 0 0 .46.69h5a .5.5 0 0 0 .46-.69l-.87-2.19c.56-.55.91-1.31.91-2.13a3 3 0 0 0 -3-3zm1.04 5.19.72 1.81h-3.51l.74-1.79a.5.5 0 0 0 -.17-.6 2 2 0 1 1 3.18-1.61c0 .64-.31 1.24-.8 1.6a.5.5 0 0 0 -.17.59zm-1.04-14.19a4 4 0 0 0 -4 4v2.5a.5.5 0 0 0 .5.5h7a .5.5 0 0 0 .5-.5v-2.5a4 4 0 0 0 -4-4zm3 6h-6v-2a3 3 0 1 1 6 0z" fill-rule="evenodd"></path></svg>
                <div style="padding-right: 35px; padding-left: 10px; padding-top: 10px;">
                    <input id="password" type="password" placeholder="Password" style="width: 100%; border: 0">
                </div>
            </div>
            <button id="login" class="white-on-red" style="margin-top: 15px; font-size: 19px; border-radius: 4px; height: 50px; width: 100%;">Log in</button>
        </form>
        <div class="common-border-top" style="margin-top: 16px; margin-bottom: 16px;"></div>
        <div style="text-align: center;">
            <span style="margin-right: 10px;">Don't have an account?</span><span><a id="signup" class="green-on-white" style="cursor: pointer;">Sign up</a></span>
        </div>
        <div id="error" style="margin-top: 10px; padding-left: 10px; background-color: orange; color: white;"></div>
    </div>
    {% block app %} {% endblock %}

    <script src="{% static 'main/lib/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'main/lib/jquery-ui-1.12.1.min.js' %}"></script>
    <script src="{% static 'main/lib/crypto-js.min.js' %}"></script>
    <script src="{% static 'main/lib/js.cookie.min.js' %}"></script>

    <script>
        function setCsrfToken(xhr) {
            let csrfToken = Cookies.get("csrftoken");
            if (!this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrfToken);
            }
        }

        function makeDlgCfg(dlg, width, height) {
            return {
                dialogClass: "no-close no-title",
                draggable: false,
                height: height,
                modal: true,
                resizable: false,
                width: width,
                open: function() {
                    dlg.find("#error").hide();
                    dlg.find("a").css("outline", "none");
                    dlg.find("button").css("outline", "none");
                    dlg.find("input").css("outline", "none");
                    let overlay = $(".ui-widget-overlay");
                    overlay.css({ "opacity": "0.7", "background-color": "black" });
                    overlay.click(function(event) {
                        dlg.dialog("close");
                    });
                }
            }
        }

        function connectDlg(btn, dlg, config) {
            btn.click(function(event) {
                event.preventDefault();
                dlg.dialog(config);
            });
        }

        function dlgResponseHandler(dlg, type, response) {
            json = response;
            if (response.responseJSON) {
                json = response.responseJSON;
            }
            let msg = null;
            if (json) {
                if (json.url) {
                    window.location = json.url;
                    return;
                }
                msg = json.msg;
            }
            dlg.find("input").val(null);
            if (!msg) {
                msg = "internal server error!";
            }
            let error = dlg.find("#error");
            error.text(msg);
            error.show();
        }

        $(document).ready(function() {
            $(".nav-logo-dd").find("#home").click(function(event) {
                event.preventDefault();
                window.location = $(".nav-logo-dd").find("#home").attr("url");
                return;
            });

            $("#btn-logout").click(function(event) {
                event.preventDefault();
                window.location = $("#btn-logout").attr("url");
                return;
            });

            let loginCfg = makeDlgCfg($("#dlg-login"), 568, 520);
            let signupCfg = makeDlgCfg($("#dlg-signup"), 568, 580);

            connectDlg($("#btn-login"), $("#dlg-login"), loginCfg)
            connectDlg($("#btn-signup"), $("#dlg-signup"), signupCfg);

            connectDlg($("#dlg-login").find("#signup"), $("#dlg-signup"), signupCfg);
            $("#dlg-login").find("#signup").click(function(event) {
                $("#dlg-login").dialog("close");
            });
            $("#dlg-login").find("#close").click(function(event) {
                $("#dlg-login").dialog("close");
            });

            connectDlg($("#dlg-signup").find("#login"), $("#dlg-login"), loginCfg);
            $("#dlg-signup").find("#login").click(function(event) {
                $("#dlg-signup").dialog("close");
            });
            $("#dlg-signup").find("#close").click(function(event) {
                $("#dlg-signup").dialog("close");
            });

            $("#dlg-signup").find("#signup").click(function(event) {
                event.preventDefault();

                email = $("#dlg-signup").find("#email").val().trim();
                fullname = $("#dlg-signup").find("#fullname").val().trim();
                password = $("#dlg-signup").find("#password").val().trim();

                if (!email || !fullname || !password) {
                    let error = $("#dlg-signup").find("#error");
                    error.text("All fields must be filled in!");
                    error.show();
                    return;
                }

                hashed_b64_pwd = CryptoJS.SHA256(password).toString(CryptoJS.enc.Base64);

                $.ajax({
                    beforeSend: setCsrfToken,
                    type: "POST",
                    url: $("#dlg-signup").find("form").attr("action"),
                    data: {
                        email: email,
                        fullname: fullname,
                        hashed_b64_pwd: hashed_b64_pwd,
                    },
                    success: function(response) {
                        dlgResponseHandler($("#dlg-signup"), 'success', response);
                    },
                    error: function(response) {
                        dlgResponseHandler($("#dlg-signup"), 'error', response);
                    },
                });
            });

            $("#dlg-login").find("#login").click(function(event) {
                event.preventDefault();

                email = $("#dlg-login").find("#email").val().trim();
                password = $("#dlg-login").find("#password").val().trim();

                if (!email || !password) {
                    let error = $("#dlg-login").find("#error");
                    error.text("All fields must be filled in!");
                    error.show();
                    return;
                }

                hashed_b64_pwd = CryptoJS.SHA256(password).toString(CryptoJS.enc.Base64);

                $.ajax({
                    beforeSend: setCsrfToken,
                    type: "POST",
                    url: $("#dlg-login").find("form").attr("action"),
                    data: {
                        email: email,
                        hashed_b64_pwd: hashed_b64_pwd,
                    },
                    success: function(response) {
                        dlgResponseHandler($("#dlg-login"), 'success', response);
                    },
                    error: function(response) {
                        dlgResponseHandler($("#dlg-login"), 'error', response);
                    },
                });
            });
        });
    </script>

    {% block scripts %} {% endblock %}
</body>
</html>

